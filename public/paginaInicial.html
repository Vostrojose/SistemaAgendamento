<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Painel - Sistema de Agendamento</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <nav class="navbar">
            <span>Painel do Usuário</span>
            <button id="logoutBtn">Sair</button>
        </nav>
    </header>

    <main>
        <h2>Bem-vindo(a) ao Sistema</h2>

        <h3>Informações do Usuário</h3>
        <div id="dadosUsuario">
            <p><b>Nome:</b> carregando...</p>
            <p><b>Email:</b> carregando...</p>
        </div>

        <hr>

        <h3>Ações disponíveis</h3>
        <ul>
            <li><a href="agendar.html">Agendar horário</a></li>
            <li><a href="meusAgendamentos.html">Ver meus agendamentos</a></li>
            <li><a href="editarPerfil.html">Editar perfil</a></li>
        </ul>
    </main>

    <script>
        const token = localStorage.getItem("tokenUsuario");
        if (!token) window.location.href = "login.html";

        async function carregarPerfil() {
            try {
                const resposta = await fetch("http://localhost:3000/usuarios/perfil", {
                    method: "GET",
                    headers: { "Authorization": "Bearer " + token }
                });

                const dados = await resposta.json();

                if (resposta.ok) {
                    document.getElementById("dadosUsuario").innerHTML = `
        <p><b>Nome:</b> ${dados.nome}</p>
        <p><b>Email:</b> ${dados.email}</p>
      `;
                } else {
                    localStorage.removeItem("tokenUsuario");
                    window.location.href = "login.html";
                }

            } catch {
                alert("Erro ao carregar o perfil.");
            }
        }

        carregarPerfil();

        document.getElementById("logoutBtn").addEventListener("click", () => {
            localStorage.removeItem("tokenUsuario");
            window.location.href = "login.html";
        });
    </script>

</body>

</html>